name: Code Quality Checks

on:
  pull_request:
    branches:
      - development

jobs:
  php-check:
    name: PHP Code Sniffer (Lenient)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: "8.2"

      - name: Install PHP_CodeSniffer
        run: |
          wget https://squizlabs.github.io/PHP_CodeSniffer/phpcs.phar -O phpcs.phar
          chmod +x phpcs.phar
          sudo mv phpcs.phar /usr/local/bin/phpcs

      - name: Run PHP_CodeSniffer (lenient)
        run: |
          phpcs ./ --extensions=php --standard=PSR12 \
            --ignore=*/vendor/* \
            --runtime-set ignore_warnings_on_exit 1 \
            --runtime-set ignore_errors_on_exit 0 \
            --runtime-set tab_width 4

  js-check:
    name: JavaScript Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "20"

      - name: Install ESLint v8
        run: npm install eslint@8 --no-package-lock

      - name: Run ESLint (self-contained)
        run: |
          npx eslint . --ext .js \
            --no-eslintrc \
            --rule 'semi: ["error", "always"]' \
            --rule 'quotes: ["error", "single"]' \
            --rule 'no-unused-vars: ["warn"]' \
            --max-warnings=0
